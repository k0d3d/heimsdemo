# the IP(s) on which your node server is running. I chose port 3000.
upstream integra.vm {
    server 127.0.0.1:3000;
}

# the nginx server instance
server {
    listen 80;
    
    listen 443 ssl; 
    
    ssl    on; 
		ssl_certificate_key         /etc/nginx/ssl/integra.vm/self-ssl.key;
		ssl_certificate             /etc/nginx/ssl/integra.vm/self-ssl.crt;

    server_name integra.vm integra;
    access_log /var/log/nginx/drugstoc.log;
    
    add_header Strict-Transport-Security max-age=500; 

    # pass the request to the node.js server with the correct headers and much more can be added, see nginx config options
    location / {
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
# This is what tells Connect that your session can be considered secure, 
# even though the protocol node.js sees is only HTTP:        
proxy_set_header X-Forwarded-Proto $scheme; 
        proxy_set_header Host $http_host;
        proxy_set_header X-NginX-Proxy true;
        proxy_read_timeout 5m;
        proxy_connect_timeout 5m;
        proxy_pass http://integra.vm;
        proxy_redirect off;     
    }
 }
